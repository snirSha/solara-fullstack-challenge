<div class="campaign-list-container">
    <div class="header">
    <h1>My Campaigns</h1>
    <button mat-raised-button color="primary" (click)="createCampaign()">
        <mat-icon>add</mat-icon>
        New Campaign
    </button>
    </div>

    <div class="filters" *ngIf="campaigns.length > 0">
    <mat-form-field appearance="outline">
        <mat-label>Filter by status</mat-label>
        <mat-select [(value)]="selectedStatus" (selectionChange)="onFilterChange()">
        <mat-option value="">All</mat-option>
        <mat-option value="pending">Pending</mat-option>
        <mat-option value="processing">Processing</mat-option>
        <mat-option value="completed">Completed</mat-option>
        <mat-option value="failed">Failed</mat-option>
        </mat-select>
    </mat-form-field>
    </div>

    <div class="loading-container" *ngIf="isLoading && campaigns.length === 0">
    <mat-spinner></mat-spinner>
    <p>Loading campaigns...</p>
    </div>

    <div class="empty-state" *ngIf="!isLoading && filteredCampaigns.length === 0">
    <mat-icon class="empty-icon">mood_bad</mat-icon>
    <h2>No campaigns found</h2>
    <p>Create your first campaign to get started with AI content generation.</p>
    </div>

    <div class="campaigns-grid" *ngIf="filteredCampaigns.length > 0">
    <mat-card 
        *ngFor="let campaign of filteredCampaigns; trackBy: trackByCampaignId" 
        class="campaign-card"
        [class.processing]="campaign.status === 'processing'">
        
        <mat-card-header>
        <div class="campaign-status">
            <mat-chip [color]="getStatusColor(campaign.status)" selected>
            <mat-icon>{{ getStatusIcon(campaign.status) }}</mat-icon>
            {{ campaign.status | titlecase }}
            </mat-chip>
        </div>
        <mat-card-title>{{ campaign.prompt | slice:0:50 }}{{ campaign.prompt.length > 50 ? '...' : '' }}</mat-card-title>
        <mat-card-subtitle>{{ campaign.createdAt | date:'medium' }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
        <div class="campaign-preview" *ngIf="campaign.status === 'completed'">
            <div class="generated-text" *ngIf="campaign.generatedText">
            <p>{{ campaign.generatedText | slice:0:100 }}{{ campaign.generatedText.length > 100 ? '...' : '' }}</p>
            </div>
            <div class="generated-image" *ngIf="campaign.imagePath">
            <img [src]="getImageUrl(campaign.imagePath)" [alt]="campaign.prompt" loading="lazy">
            </div>
        </div>
        
        <div class="processing-indicator" *ngIf="campaign.status === 'processing'">
            <mat-progress-bar mode="indeterminate"></mat-progress-bar>
            <p>Generating content...</p>
        </div>

        <div class="error-message" *ngIf="campaign.status === 'failed'">
            <mat-icon color="warn">error</mat-icon>
            <p>{{ campaign.error || 'Generation failed' }}</p>
        </div>
        </mat-card-content>

        <mat-card-actions>
        <button mat-button (click)="viewCampaign(campaign.id); $event.stopPropagation()">
            <mat-icon>visibility</mat-icon>
            View Details
        </button>
        <button 
            mat-button 
            *ngIf="campaign.status === 'failed'"
            (click)="retryCampaign(campaign); $event.stopPropagation()">
            <mat-icon>refresh</mat-icon>
            Retry
        </button>
        <button
            mat-button
            color="warn"
            (click)="deleteCampaign(campaign); $event.stopPropagation()">
            <mat-icon>delete</mat-icon>
            Delete
        </button>
        </mat-card-actions>
    </mat-card>
    </div>
    </div>